<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://linkml.github.io/linkml-map/examples/Tutorial/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Tutorial - LinkML-Map</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../css/ansi-colours.css" rel="stylesheet">
    <link href="../../css/jupyter-cells.css" rel="stylesheet">
    <link href="../../css/pandas-dataframe.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "LinkML-Map tutorial", url: "#_top", children: [
              {title: "Creating an example schema", url: "#creating-an-example-schema" },
              {title: "Creating a Transformer Session object", url: "#creating-a-transformer-session-object" },
              {title: "Visualizing transformer specifications", url: "#visualizing-transformer-specifications" },
              {title: "Transforming objects", url: "#transforming-objects" },
              {title: "Deriving target schemas", url: "#deriving-target-schemas" },
              {title: "Using Expressions", url: "#using-expressions" },
              {title: "Unit conversions", url: "#unit-conversions" },
              {title: "Adding target_unit to transformer specification", url: "#adding-target_unit-to-transformer-specification" },
              {title: "Units in derived schema", url: "#units-in-derived-schema" },
              {title: "Tabular serialization", url: "#tabular-serialization" },
              {title: "Reverse transform", url: "#reverse-transform" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../datamodel/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../datamodel/" class="btn btn-xs btn-link">
        Data Model
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../.." class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../.." class="btn btn-xs btn-link">
        Index
      </a>
    </div>
    
  </div>

    

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script>
(function() {
  function addWidgetsRenderer() {
    var requireJsScript = document.createElement('script');
    requireJsScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js';

    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var jupyterWidgetsScript = document.createElement('script');
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        widgetRendererSrc = 'jupyter-js-widgets@*/dist/embed.js';
      }
    } catch(e) {}

    jupyterWidgetsScript.src = widgetRendererSrc;

    document.body.appendChild(requireJsScript);
    document.body.appendChild(jupyterWidgetsScript);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
</script>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="linkml-map-tutorial">LinkML-Map tutorial</h1>
<p>This tutorial walks through basic programmatic use of the LinkML-Map framework.
This is intended for Python developers - note that many of the operations here can also be performed
at the command line.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">import yaml
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="creating-an-example-schema">Creating an example schema</h2>
<p>We will use a LinkML SchemaBuilder object to progressively build up a schema, adding
additional features as we go.</p>
<p>We'll start with a simple <code>Person</code> schema, with a few single valued scalar slots:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">from linkml.utils.schema_builder import SchemaBuilder
from linkml_runtime.linkml_model import SlotDefinition

sb = SchemaBuilder()
sb.add_class(&quot;Person&quot;, slots=[SlotDefinition(&quot;family_name&quot;, range=&quot;string&quot;), 
                              SlotDefinition(&quot;given_name&quot;, range=&quot;string&quot;),
                              SlotDefinition(&quot;age_in_years&quot;, range=&quot;integer&quot;),
                              SlotDefinition(&quot;height_in_cm&quot;, range=&quot;float&quot;),
                              ])
sb.add_defaults()
print(yaml.dump(sb.as_dict(), sort_keys=False))
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>name: test-schema
id: http://example.org/test-schema
imports:
- linkml:types
prefixes:
  linkml: https://w3id.org/linkml/
  test_schema: http://example.org/test-schema/
default_prefix: test_schema
default_range: string
slots:
  family_name:
    range: string
  given_name:
    range: string
  age_in_years:
    range: integer
  height_in_cm:
    range: float
classes:
  Person:
    slots:
    - family_name
    - given_name
    - age_in_years
    - height_in_cm
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="creating-a-transformer-session-object">Creating a Transformer Session object</h2>
<p>We will use a <code>Session</code> object which conveniently wraps a number of different capabilities;
the first of these capabilities is to map (transform) data objects from one schema to another
(implicit) schema using a <em>transformer specification</em>).</p>
<p>Our initial transformer specification will be a trivial isomorphic one that:</p>
<ul>
<li>maps the <code>Person</code> class to an <code>Individual</code> class</li>
<li>passes through <code>name</code> fields as-is</li>
<li>renames measurement fields (<code>age_in_years</code> and <code>height_in_cm</code> to <code>age</code> and <code>height</code>)</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">from linkml_map.session import Session

session = Session()
session.set_source_schema(sb.as_dict())
</code></pre>


</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python"># Transformer specification (in YAML)
session.set_object_transformer(&quot;&quot;&quot;
class_derivations:
  Individual:
    populated_from: Person
    slot_derivations:
      family_name:
        populated_from: family_name
      given_name:
        populated_from: given_name
      age:
        populated_from: age_in_years
      height:
        populated_from: height_in_cm
&quot;&quot;&quot;)
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="visualizing-transformer-specifications">Visualizing transformer specifications</h2>
<p>We can visualize the transformer specification using graphviz:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">session.graphviz()
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_svg output_subarea output_execute_result">

<?xml version="1.0" encoding="UTF-8" standalone="no"?>



<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">




<!-- Generated by graphviz version 5.0.1 (20220820.1526)
 -->



<!-- Pages: 1 -->


<svg height="121pt" viewbox="0.00 0.00 324.00 121.00" width="324pt" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g class="graph" id="graph0" transform="scale(1 1) rotate(0) translate(4 117)">
<polygon fill="white" points="-4,4 -4,-117 320,-117 320,4 -4,4" stroke="none"></polygon>

<!-- sourcePerson -->


<g class="node" id="node1">
<title>sourcePerson</title>
<polygon fill="none" points="8.5,-87.5 8.5,-108.5 135.5,-108.5 135.5,-87.5 8.5,-87.5" stroke="black"></polygon>
<text font-family="Times,serif" font-size="14.00" font-weight="bold" text-anchor="start" x="52" y="-95.3">Person</text>
<polyline fill="none" points="8.5,-87.5 8.5,-66.5 135.5,-66.5 135.5,-87.5" stroke="black"></polyline>
<text font-family="Times,serif" font-size="14.00" text-anchor="start" x="14.5" y="-73.3">family_name : string</text>
<polyline fill="none" points="8.5,-66.5 8.5,-45.5 135.5,-45.5 135.5,-66.5" stroke="black"></polyline>
<text font-family="Times,serif" font-size="14.00" text-anchor="start" x="17.5" y="-52.3">given_name : string</text>
<polyline fill="none" points="8.5,-45.5 8.5,-24.5 135.5,-24.5 135.5,-45.5" stroke="black"></polyline>
<text font-family="Times,serif" font-size="14.00" text-anchor="start" x="11.5" y="-31.3">age_in_years : integer</text>
<polyline fill="none" points="8.5,-24.5 8.5,-3.5 135.5,-3.5 135.5,-24.5" stroke="black"></polyline>
<text font-family="Times,serif" font-size="14.00" text-anchor="start" x="16" y="-10.3">height_in_cm : float</text>
</g>

<!-- targetIndividual -->


<g class="node" id="node2">
<title>targetIndividual</title>
<polygon fill="none" points="187.5,-87.5 187.5,-108.5 308.5,-108.5 308.5,-87.5 187.5,-87.5" stroke="black"></polygon>
<text font-family="Times,serif" font-size="14.00" font-weight="bold" text-anchor="start" x="217.5" y="-95.3">Individual</text>
<polyline fill="none" points="187.5,-87.5 187.5,-66.5 308.5,-66.5 308.5,-87.5" stroke="black"></polyline>
<text font-family="Times,serif" font-size="14.00" text-anchor="start" x="190.5" y="-73.3">family_name : string</text>
<polyline fill="none" points="187.5,-66.5 187.5,-45.5 308.5,-45.5 308.5,-66.5" stroke="black"></polyline>
<text font-family="Times,serif" font-size="14.00" text-anchor="start" x="193.5" y="-52.3">given_name : string</text>
<polyline fill="none" points="187.5,-45.5 187.5,-24.5 308.5,-24.5 308.5,-45.5" stroke="black"></polyline>
<text font-family="Times,serif" font-size="14.00" text-anchor="start" x="214" y="-31.3">age : integer</text>
<polyline fill="none" points="187.5,-24.5 187.5,-3.5 308.5,-3.5 308.5,-24.5" stroke="black"></polyline>
<text font-family="Times,serif" font-size="14.00" text-anchor="start" x="213" y="-10.3">height : float</text>
</g>

<!-- sourcePerson&#45;&gt;targetIndividual -->


<g class="edge" id="edge1">
<title>sourcePerson:family_name-&gt;targetIndividual:family_name</title>
<path d="M136.5,-77.5C154.9,-77.5 161.88,-77.5 176.35,-77.5" fill="none" stroke="black"></path>
<polygon fill="black" points="176.5,-81 186.5,-77.5 176.5,-74 176.5,-81" stroke="black"></polygon>
</g>

<!-- sourcePerson&#45;&gt;targetIndividual -->


<g class="edge" id="edge2">
<title>sourcePerson:given_name-&gt;targetIndividual:given_name</title>
<path d="M136.5,-55.5C154.9,-55.5 161.88,-55.5 176.35,-55.5" fill="none" stroke="black"></path>
<polygon fill="black" points="176.5,-59 186.5,-55.5 176.5,-52 176.5,-59" stroke="black"></polygon>
</g>

<!-- sourcePerson&#45;&gt;targetIndividual -->


<g class="edge" id="edge3">
<title>sourcePerson:age_in_years-&gt;targetIndividual:age</title>
<path d="M136.5,-34.5C154.9,-34.5 161.88,-34.5 176.35,-34.5" fill="none" stroke="black"></path>
<polygon fill="black" points="176.5,-38 186.5,-34.5 176.5,-31 176.5,-38" stroke="black"></polygon>
</g>

<!-- sourcePerson&#45;&gt;targetIndividual -->


<g class="edge" id="edge4">
<title>sourcePerson:height_in_cm-&gt;targetIndividual:height</title>
<path d="M136.5,-13.5C154.9,-13.5 161.88,-13.5 176.35,-13.5" fill="none" stroke="black"></path>
<polygon fill="black" points="176.5,-17 186.5,-13.5 176.5,-10 176.5,-17" stroke="black"></polygon>
</g>
</g>
</svg>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="transforming-objects">Transforming objects</h2>
<p>We'll next make a simple <code>Person</code> object. Note that for simplicity we are specifying this
using a Python dictionary. The framework also works with objects instantiating either
Pydantic or Dataclasses classes (use the <code>transform_object</code> method instead of <code>transform</code>).</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">obj = {
        &quot;given_name&quot;: &quot;Jane&quot;,
        &quot;family_name&quot;: &quot;Doe&quot;,
        &quot;age_in_years&quot;: 42,
        &quot;height_in_cm&quot;: 180.0,
    }
session.transform(obj)
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>{'family_name': 'Doe', 'given_name': 'Jane', 'age': 42, 'height': 180.0}</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This does what we expect - it renames the two fields, but leaves all values intact.</p>
<p>Note that because we use using dictionaries here, the renaming of the class has no effect,
as this is implicit with JSON/dictionaries.</p>
<p>TODO: docs on type designator fields</p>
<p>For command line users, the same thing can be achieved with the <code>map-data</code> command.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="deriving-target-schemas">Deriving target schemas</h2>
<p>LinkML-Transformer is intended as a <em>declarative</em> framework, in contrast to writing Python
transformation code. This allows tools to introspect mappings and perform other kinds of inference.
An example of this is <em>deriving the (implicit) target schema</em></p>
<p>Here we use the <code>target_schema</code> method on the session object to derive the target schema:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">from linkml_runtime.dumpers import yaml_dumper

print(yaml_dumper.dumps(session.target_schema))
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>name: test-schema-derived
id: http://example.org/test-schema-derived
imports:
- linkml:types
prefixes:
  linkml:
    prefix_prefix: linkml
    prefix_reference: https://w3id.org/linkml/
  test_schema:
    prefix_prefix: test_schema
    prefix_reference: http://example.org/test-schema/
default_prefix: http://example.org/test-schema-derived/
default_range: string
classes:
  Individual:
    name: Individual
    attributes:
      family_name:
        name: family_name
        domain_of:
        - Person
        range: string
      given_name:
        name: given_name
        domain_of:
        - Person
        range: string
      age:
        name: age
        domain_of:
        - Person
        range: integer
      height:
        name: height
        domain_of:
        - Person
        range: float
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As expected, this is isomorphic to the original (source) schema, with fields and classes renamed.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="using-expressions">Using Expressions</h2>
<p>In addition to renaming fields, we can derive field values via evaluation of function <em>expressions</em>.</p>
<p>You are encouraged to follow the subset of Python defined by the LinkML expression language. This provides
both safety, and declarativity. However, if you need
to, you can include arbitrary Python code, provided you configure the session to allow this.</p>
<p>We'll keep the original schema, and will provide a new Transformer specification, 
giving an example of both string manipulation functions and arithmetic functions; the latter
perform unit conversions (later on we will see more flexible and declarative ways to perform unit conversions).</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">
session.set_object_transformer(&quot;&quot;&quot;
class_derivations:
  Individual:
    populated_from: Person
    slot_derivations:
      name:
        expr: &quot;{given_name} + ' ' + {family_name}&quot;
        description: Concatenating given and family names
          note this is a bad assumption for names in general,
          this is just for demonstration
      age_in_months:
        expr: age_in_years * 12
      height_in_meters:
        expr: height_in_cm / 100
&quot;&quot;&quot;)

</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note that when we visualize this specification, dotted lines are shown indicating a relationship
between source and target that is different from direct copy:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">session.graphviz()
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_svg output_subarea output_execute_result">

<?xml version="1.0" encoding="UTF-8" standalone="no"?>



<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">




<!-- Generated by graphviz version 5.0.1 (20220820.1526)
 -->



<!-- Pages: 1 -->


<svg height="122pt" viewbox="0.00 0.00 346.00 121.50" width="346pt" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g class="graph" id="graph0" transform="scale(1 1) rotate(0) translate(4 117.5)">
<polygon fill="white" points="-4,4 -4,-117.5 342,-117.5 342,4 -4,4" stroke="none"></polygon>

<!-- sourcePerson -->


<g class="node" id="node1">
<title>sourcePerson</title>
<polygon fill="none" points="8.5,-88 8.5,-109 135.5,-109 135.5,-88 8.5,-88" stroke="black"></polygon>
<text font-family="Times,serif" font-size="14.00" font-weight="bold" text-anchor="start" x="52" y="-95.8">Person</text>
<polyline fill="none" points="8.5,-88 8.5,-67 135.5,-67 135.5,-88" stroke="black"></polyline>
<text font-family="Times,serif" font-size="14.00" text-anchor="start" x="14.5" y="-73.8">family_name : string</text>
<polyline fill="none" points="8.5,-67 8.5,-46 135.5,-46 135.5,-67" stroke="black"></polyline>
<text font-family="Times,serif" font-size="14.00" text-anchor="start" x="17.5" y="-52.8">given_name : string</text>
<polyline fill="none" points="8.5,-46 8.5,-25 135.5,-25 135.5,-46" stroke="black"></polyline>
<text font-family="Times,serif" font-size="14.00" text-anchor="start" x="11.5" y="-31.8">age_in_years : integer</text>
<polyline fill="none" points="8.5,-25 8.5,-4 135.5,-4 135.5,-25" stroke="black"></polyline>
<text font-family="Times,serif" font-size="14.00" text-anchor="start" x="16" y="-10.8">height_in_cm : float</text>
</g>

<!-- targetIndividual -->


<g class="node" id="node2">
<title>targetIndividual</title>
<polygon fill="none" points="187.5,-67 187.5,-88 330.5,-88 330.5,-67 187.5,-67" stroke="black"></polygon>
<text font-family="Times,serif" font-size="14.00" font-weight="bold" text-anchor="start" x="228.5" y="-74.8">Individual</text>
<polyline fill="none" points="187.5,-67 187.5,-46 330.5,-46 330.5,-67" stroke="black"></polyline>
<text font-family="Times,serif" font-size="14.00" text-anchor="start" x="222.5" y="-52.8">name : string</text>
<polyline fill="none" points="187.5,-46 187.5,-25 330.5,-25 330.5,-46" stroke="black"></polyline>
<text font-family="Times,serif" font-size="14.00" text-anchor="start" x="196" y="-31.8">age_in_months : string</text>
<polyline fill="none" points="187.5,-25 187.5,-4 330.5,-4 330.5,-25" stroke="black"></polyline>
<text font-family="Times,serif" font-size="14.00" text-anchor="start" x="190.5" y="-10.8">height_in_meters : string</text>
</g>

<!-- sourcePerson&#45;&gt;targetIndividual -->


<g class="edge" id="edge1">
<title>sourcePerson:given_name-&gt;targetIndividual:name</title>
<path d="M136.5,-56C154.91,-56 161.87,-56.69 176.35,-56.92" fill="none" stroke="black" stroke-dasharray="5,2"></path>
<polygon fill="black" points="176.47,-60.42 186.5,-57 176.53,-53.42 176.47,-60.42" stroke="black"></polygon>
</g>

<!-- sourcePerson&#45;&gt;targetIndividual -->


<g class="edge" id="edge2">
<title>sourcePerson:family_name-&gt;targetIndividual:name</title>
<path d="M136.5,-78C156.65,-78 161.21,-63.33 176.24,-58.51" fill="none" stroke="black" stroke-dasharray="5,2"></path>
<polygon fill="black" points="177.12,-61.92 186.5,-57 176.1,-54.99 177.12,-61.92" stroke="black"></polygon>
</g>

<!-- sourcePerson&#45;&gt;targetIndividual -->


<g class="edge" id="edge3">
<title>sourcePerson:age_in_years-&gt;targetIndividual:age_in_months</title>
<path d="M136.5,-35C154.9,-35 161.88,-35 176.35,-35" fill="none" stroke="black" stroke-dasharray="5,2"></path>
<polygon fill="black" points="176.5,-38.5 186.5,-35 176.5,-31.5 176.5,-38.5" stroke="black"></polygon>
</g>

<!-- sourcePerson&#45;&gt;targetIndividual -->


<g class="edge" id="edge4">
<title>sourcePerson:height_in_cm-&gt;targetIndividual:height_in_meters</title>
<path d="M136.5,-14C154.9,-14 161.88,-14 176.35,-14" fill="none" stroke="black" stroke-dasharray="5,2"></path>
<polygon fill="black" points="176.5,-17.5 186.5,-14 176.5,-10.5 176.5,-17.5" stroke="black"></polygon>
</g>
</g>
</svg>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we'll transform the same object as before, and see the results:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">session.transform(obj)
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>{'name': 'Jane Doe', 'age_in_months': 504, 'height_in_meters': 1.8}</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As expected, we concatenated the name fields, and converted the age and height fields to different units.</p>
<p>Let's take a look at the derived schema for this new transformation:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">print(yaml_dumper.dumps(session.target_schema))
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>name: test-schema-derived
id: http://example.org/test-schema-derived
imports:
- linkml:types
prefixes:
  linkml:
    prefix_prefix: linkml
    prefix_reference: https://w3id.org/linkml/
  test_schema:
    prefix_prefix: test_schema
    prefix_reference: http://example.org/test-schema/
default_prefix: http://example.org/test-schema-derived/
default_range: string
classes:
  Individual:
    name: Individual
    attributes:
      name:
        name: name
      age_in_months:
        name: age_in_months
      height_in_meters:
        name: height_in_meters
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note that at this time, deriving ranges using expressions is not supported, so the two measurement fields
are erroneously typed as having the <code>default_range</code> of <code>string</code>. However, in principle, if you use the
linkml subset of Python it should be possible to infer the range of the derived field, and this may be added
in future versions. Currently the tool chain is at an early stage of development.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="unit-conversions">Unit conversions</h2>
<p>Next we will look at a different way of doing unit conversions. The LinkML specification allows
schemas to explicitly declare the units of slots, so let's modify our schema to do this, adding
a UCUM code for our <code>height_in_cm</code> slot:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">from linkml_runtime.linkml_model.units import UnitOfMeasure
sb.schema.slots['height_in_cm'].unit = UnitOfMeasure(ucum_code='cm')
session.set_source_schema(sb.as_dict())
print(yaml.dump(sb.as_dict(), sort_keys=False))
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>name: test-schema
id: http://example.org/test-schema
imports:
- linkml:types
prefixes:
  linkml: https://w3id.org/linkml/
  test_schema: http://example.org/test-schema/
default_prefix: test_schema
default_range: string
slots:
  family_name:
    range: string
  given_name:
    range: string
  age_in_years:
    range: integer
  height_in_cm:
    range: float
    unit:
      ucum_code: cm
classes:
  Person:
    slots:
    - family_name
    - given_name
    - age_in_years
    - height_in_cm
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="adding-target_unit-to-transformer-specification">Adding target_unit to transformer specification</h2>
<p>We will create a new transformer specification, focusing on the <code>height_in_cm</code> field. We will
transform this into a <code>height_in_meters</code> field, and will use the <code>target_unit</code> field to specify
the target unit.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">session.set_object_transformer(&quot;&quot;&quot;
class_derivations:
  Individual:
    populated_from: Person
    slot_derivations:
      name:
        expr: &quot;{given_name} + ' ' + {family_name}&quot;
      height_in_meters:
        populated_from: height_in_cm
        unit_conversion:
          target_unit: m
&quot;&quot;&quot;)
</code></pre>


</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">session.transform(obj)
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>{'name': 'Jane Doe', 'height_in_meters': 1.8}</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="units-in-derived-schema">Units in derived schema</h2>
<p>Next we'll look at the derived target schema, and as expected we see that it has inferred
the target unit for the <code>height_in_meters</code> field:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">print(yaml_dumper.dumps(session.target_schema))

</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>name: test-schema-derived
id: http://example.org/test-schema-derived
imports:
- linkml:types
prefixes:
  linkml:
    prefix_prefix: linkml
    prefix_reference: https://w3id.org/linkml/
  test_schema:
    prefix_prefix: test_schema
    prefix_reference: http://example.org/test-schema/
default_prefix: http://example.org/test-schema-derived/
default_range: string
classes:
  Individual:
    name: Individual
    attributes:
      name:
        name: name
      height_in_meters:
        name: height_in_meters
        domain_of:
        - Person
        range: float
        unit:
          ucum_code: m
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="tabular-serialization">Tabular serialization</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">slot = sb.add_slot(&quot;aliases&quot;, multivalued=True, range=&quot;string&quot;, replace_if_present=True)
</code></pre>


</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">sb.schema.classes['Person'].slots.append(slot.name)
</code></pre>


</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">session.set_source_schema(sb.as_dict())
</code></pre>


</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">session.set_object_transformer(&quot;&quot;&quot;
class_derivations:
  Individual:
    populated_from: Person
    slot_derivations:
      family_name:
        populated_from: family_name
      given_name:
        populated_from: given_name
      age:
        populated_from: age_in_years
      height:
        populated_from: height_in_cm
      aliases:
        populated_from: aliases
        stringification:
          delimiter: '|'
&quot;&quot;&quot;)    
</code></pre>


</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">obj = {
        &quot;given_name&quot;: &quot;Jane&quot;,
        &quot;family_name&quot;: &quot;Doe&quot;,
        &quot;age_in_years&quot;: 42,
        &quot;height_in_cm&quot;: 180.0,
        &quot;aliases&quot;: [&quot;Jane&quot;, &quot;Janie&quot;, &quot;Janey&quot;]
    }
flattened = session.transform(obj)
flattened
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>{'family_name': 'Doe',
 'given_name': 'Jane',
 'age': 42,
 'height': 180.0,
 'aliases': 'Jane|Janie|Janey'}</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>this can easily be serialized to a CSV/TSV</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="reverse-transform">Reverse transform</h2>
<p>If a transform does not contain one-way functions,
it can be <em>reversed</em>.</p>
<p>In this case, reversing the transform allows us to map
from the tabular form back to the richer original representation.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">session.reverse_transform(flattened)
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>{'family_name': 'Doe',
 'given_name': 'Jane',
 'age_in_years': 42,
 'height_in_cm': 180.0,
 'aliases': ['Jane', 'Janie', 'Janey']}</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">
</code></pre>


</div>
</div>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../datamodel/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../datamodel/" class="btn btn-xs btn-link">
        Data Model
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../.." class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../.." class="btn btn-xs btn-link">
        Index
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
      <p>
        <a href="https://github.com/linkml/linkml-map/edit/master/docs/examples/Tutorial.ipynb"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>